---
title: "Tipping points in diversified farming systems" 
author:
  - name: Melissa Chapman
    affiliation: espm
  - name: Serge Wiltshire
    affiliation: espm
  - name: Timothy Bowles
    affiliation: espm
  - name: Liz Carlisle
    affiliation: ucsb
  - name: Fredrico Castillo
    affiliation: espm
  - name: David Gonthier
    affiliation: ky
  - name: Alastair Iles
    affiliation: espm
  - name: Daniel Karp
    affiliation: davis
  - name: Claire Kremen
    affiliation: espm, ucb
  - name: Jeff Liebert
    affiliation: cornell
  - name: Elissa Olimpi
    affiliation: davis
  - name: Matthew Ryan
    affiliation: cornell
  - name: Amber Sciligo
    affiliation: organic
  - name: Jennifer Thompson
    affiliation: espm
  - name: Hannah Waterhouse
    affiliation: espm
  - name: Kenzo Eszquivel
    affiliation: espm
  - name: Sasha Gennet
    affiliation: tnc
  - name: Carl Boettiger
    affiliation: espm
    footnote: Corresponding Author
address:
  - code: espm
    address: "Dept. of Environmental Science, Policy, and Management, University of California Berkeley, Berkeley, CA, USA"
  - code: ubc
    address: "Institute of Resources, Environment and Sustainability, University of British Columbia, Vancouver, BC, Canada"
  - code: ucsb
    address: "Environmental Studies, University of California Santa Barbara, Santa Barbara, CA, USA"
  - code: davis
    address: "Wildlife, Fish, and Conservation Biology, University of California Davis, Davis, CA, USA"
  - code: ky
    address: "Dept. of Entomology, University of Kentucky, Lexington, KY, USA"
  - code: cornell
    address: "School of Integrated Plant Science, Cornell University, Cornell, NY, USA"
  - code: organic
    address: "The Organic Center, Washington, DC, USA"
  - code: tnc
    address: "The Nature Conservancy, Arlington, VA, USA" # added location of TNC HQ to match other entries
    
abstract: The emergence and impact of tipping points are of great interest in both social and ecological research. Despite widespread recognition of the importance of feedbacks between human and environmental systems, it is often assumed that the observed nonlinear dynamics in these coupled systems rest within either underlying human or environmental processes. Using adoption of agroecological practices as a case study, we show how bistability in ecosystem states and services can emerge purely from the temporal feedbacks between human decisions and ecological responses. We propose that the understanding the mechanisms of tipping points in social-environmental systems is critical to designing effective policy interventions in numerous environmental contexts.  For example, our results indicate how policies which increase the duration of land tenure and provide long-term incentives are particularly effective at enhancing the adoption of agricultural diversification practices.

keywords:
  - agriculture,
  - ecosystem services,
  - tipping points,
  - diversification practices,
  - decision-making
bibliography: references.bib
date: "`r Sys.Date()`"
output: rticles::elsevier_article
layout: 3p # review # review = doublespace, 3p = singlespace, 5p = two-column
header-includes: 
  - \journal{TBD}
  - \graphicspath{{ext-figs/}}
  - \usepackage{float}
  - \linenumbers
  - \usepackage{setspace}\doublespacing

---

```{r render_to_word_doc, include = FALSE, eval = FALSE}
# run this to generate a word doc
# not perfect, will have to format word doc after
library(rmarkdown)
render("dfs-mdp-manuscript.Rmd", word_document())

```


```{r setup, include = FALSE}
rm(list = ls(all.names = TRUE)) # clean environment

# load external scripts
source("../R/load-libraries.R")
source("../R/dfs-mdp-model.R")
source("../R/sim-plot-fxns.R")

knitr::opts_chunk$set(echo = FALSE,
                      cache = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      # eval = FALSE, # to knit faster - comment out to run code
                      fig.align = "center",
                      dev = "cairo_pdf")

pal <- solarized_pal()(7) # global color pallette
set.seed(4) # random seed
```

```{r model_def, include = FALSE}
# set up the MDP
actions <- seq(0, 1, length = 100)
states <- seq(0, 1.5, length = 100)
params <- list(
  benefit = 1.57, # changed from 1.56 to 1.57 to equalize distribution and help with fig 4 results
  cost = 1, 
  sigma = 0.1, 
  r = 0.1, 
  discount = 0.97, 
  Tmax = 20)
transition_fn <- function(s, a, params) s + params$r * (a - s)
utility_fn <- function(s, a, params) params$benefit * s - params$cost * a
model <- continuous_model(states, actions, params, transition_fn, utility_fn)

# solve the MDP
base_soln <- MDPtoolbox::mdp_value_iteration(model$P, model$U, params$discount)
base_soln_df <- tibble(state = states,
                       action = actions[base_soln$policy])

```

```{r global_sim_params, include = FALSE}
reps <- 500
init <- truncnorm::rtruncnorm(reps, 0, 1, 0.5, 0.2) %>% 
  map_int(function(x) which.min(abs(x - states)))
```


# Introduction
Both ecosystems and social systems can change states abruptly as the result of crossing critical thresholds. Theories of ecological multistability have long described this phenomenon (Beisner, Haydon, and Cuddington 2003; Scheffer et al. 2001) and explored how management impacts stability landscapes of these systems (Horan et al. 2011). Tipping points in natural systems are generally assumed to stem from complex ecological processes like population dynamics and species interactions (Dai et al. 2012; Mumby, Hastings, and Edwards 2007; Scheffer 2010). Similarly, examples of tipping points in social systems, ranging from the collapse of civilizations (Downey, Haas, and Shennan 2016) to the spread of innovations through social network processes (Redmond 2003) suggest that observed nonlinearities in social systems can result from features of human decisions. 
In social-ecological systems (SES), human actions impact ecological processes and the resultant ecological changes create feedbacks that alter the scope and efficacy of future management actions (Liu et al. 2007; Ostrom 2009; Walker et al. 2004). These coupled systems become increasingly complex when the dynamics of ecological processes do not align with thre temporal scale of human decision-making (Cumming, Cumming, and Redman 2006). Techniques previously used to investigate dynamic ecological processes and responsive decision-making have centered around one or the other, often overlooking the temporal complexity of decision-making (Lippe et al. 2019). For example, the time horizon of decisions and the rate of decision-making in relation to the rate of ecological processes is difficult to integrate in classic methods, such as dynamic equations. 

Agriculture is a fundamental driver of anthropogenic ecological change (Foley et al. 2005, 2011; Stoate et al. 2009), presenting an ideal context for examining how social and ecological systems interact. It is increasingly recognized that effectively designing policies to promote agricultural sustainability require interdisciplinary approaches that jointly consider  human decision-making and ecological factors (Alberti et al. 2011; Liu et al. 2007). While adoption of sustainable farm management undoubtedly encompasses a continuum of actions and outcomes, suites of practices are often used together in a package, coalescing around distinct stable states or “syndromes” (Andow and Hidaka 1989; Ong and Liao 2020; Vandermeer 1997). However, the mechanisms driving these bistable patterns and the transitions between different production syndromes is still debated (Ong and Liao 2020; Vandermeer and Perfecto 2012). While the overall dynamic behaviour includes the four general patterns described above, the existence of the two particular syndromes is nevertheless an inevitable consequence of the particular assumptions of the model. The nature of the functions that go into the functional composition is important. Both the production function (f) and the decision function (g) must be non-monotonic for the characteristic two-humped shape of F to emerge. If either one of them is monotonic, F is characterized by either a single hump or is itself monotonic, making it impossible to generate alternative syndromes of production via the proposed mechanism. Complex behavior of the system is still possible (perhaps even likely—Vandermeer, 1990), but the interesting situation of alternative syndromes is not achievable. 

This paper presents a stylized model of the adoption of diversified agricultural practices (practices that bolster ecosystem services by promoting beneficial agrobiodiversity (Kremen, Iles, and Bacon 2012)) to explore the ecosystem service patterns that result specifically from interactions between adaptive decision-making and an ever-changing environment. We find a mechanism for bistability, or two prevailing environmental (ecosystem service) states, that is the result not of complex structural assumptions within either the human or ecological system, but rather the rates at which the two systems interact. While our model necessarily simplifies both decision-making and environmental processes, it provides a framework to explore emergent properties in social-ecological systems. We show that our findings have important implications for agricultural policy implementation and social-ecological systems theory.

# Conceptual model description

We explore the transition to and from diversified farming systems using a Markov Decision Process (MDP) in which a farmer makes a series of decisions about whether or not to employ diversified farming practices over time (Figure 1). In the context of diversified farming systems, diversification practices, such as the use of compost, crop rotation, intercrops, reduced tillage, and cover crops, are distinct from the concept of operational diversification (i.e., simply increasing the range of agricultural goods produced on a given farm). The model was developed through an iterative, collaborative process with an interdisciplinary team comprising plant and soil scientists, agricultural economists, ecologists, agricultural policy experts, social scientists, and farmers with the goal was to capture the core complexities stemming from the coupled human and natural dynamics of the modeled system (Supporting information).

In our model at each time step the farmer takes an “action” of 0\% to 100\% percent investment in adopting or maintaining diversification practices. The “system state” corresponds to the level of benefit derived from the ecosystem services that result from those adoption decisions. Benefits may be financial, social, ideological, and/or aesthetic. A greater percent investment in diversification practices corresponds to a greater probability of transitioning to a higher (more beneficial) ecological state in the next year. While higher ecological states are beneficial, investments in diversification practices also come with higher associated costs compared to non-diversified farms. By defining parameter values for cost, benefit, transition stochasticity, ecological change rate, and future discounting (Methods, Table 1), we can allow the optimal action strategy for the agent (farmer) to emerge based on expected rewards over either a finite (to represent short-tenure leased farms) or infinite (to represent longer-term leases and land ownership) time horizon.

```{r assumption, echo = FALSE, message=FALSE, fig.align='center', fig.cap='Some cool caption', out.width='1\\linewidth', fig.pos='H'}
knitr::include_graphics("external-figs/assumptions.png")
```

```{r}
library(pander)
library(kableExtra)

assumptions <- data.frame(`Model assumptions`= 
                     c("A1: Larger actions are more costly. We approximate that with a linear term (Equation 1)",
                       "A2: Higher ecosystem service states provide more benefit to agents. We approximate that with a linear term (Equation 2)",
                       "A3:Actions change ecosystem states relative to the state (i.e., high ecosystem states require higher actions to increase). We again approximate with a linear term. ",
                       "A4: Agents make decisions to maximize discounted expected rewards over a decision horizon; ecological processes respond over time relative to a given rate, r"),
                   `Rational`=c("Actions accrue costs (i.e., investing time and area for cover cropping). This cost increases as actions increase.", 
                                "High ecosystem service states (i.e., healthy soil) provide more benefits than low ecosystem states (i.e., degraded soil).",
                                "Agents might first invest in practices with largest ecosystem service impact per cost, leaving marginally more expensive practices for future investments.",
                                "Maximizing expected discounted rewards is a common assumption in economics; ecological systems do not respond instantaneously to management actions"))

kable(assumptions, "latex") %>%
  column_spec(c(1,2), width = "15em") %>%
  kable_styling(font_size = 10) %>%
  kable_styling(latex_options = "striped")
```



# Results

## Bistability in ecosystem services

Using the described model, we observe the behavior of agents’ sequential choices and resultant environmental outcomes through time. The decision strategy pi describes the emergent optimal course of action for a given state and is used by all agents across replicate simulations.  For the parameter values given in Table 1 the resultant $\pi$ is the stationary optimal state-dependent decision strategy over an infinite time horizon (Fig 2A). 

Agents’ initial ecosystem states were distributed normally around a mean of $s =0.5$. We find that after following the optimal decision strategy (infinite horizon) for 20 decision cycles, agents have largely settled into two stable ecosystem states, with some farms transitioning to more simplified (lower levels of ecosystem services) farming systems, and others to more diversified (higher levels ecosystem services) systems (Fig 2B and C). Further, we find strong path dependency, with only 17\% of agents who started in a simplified ($s<0.5$) state concluding in a diversified ($s>0.5$) state, and only 7\% initially in the diversified state transitioning to a simplified state.


```{r base_case_sim, include = FALSE}
sim <- function(soln, 
                Tmax = params$Tmax,
                x0 = init){
  map_dfr(1:length(x0), 
          function(i) sim_mdp(model$P, model$U, soln$policy, params$discount, x0 = x0[i], Tmax = Tmax), 
          .id = "reps")
}
sims_baseline <- sim(base_soln)
# p_up_dn(sims_baseline)
```


```{r res_strategy, fig.cap = "Optimal decision strategy $\\pi$ as a function of ES state, showing a tipping point at $s \\approx 0.52$.  The upper $x$ axis limit is the 99th percentile of observed states in our simulation results ($s \\approx 1.3$).", fig.width = 3, fig.asp = 1, include=FALSE}

state99th <- sims_baseline %>% 
  mutate(state = states[state]) %>% 
  pull(state) %>% 
  quantile(.99) %>% 
  unname()
tpt <- 0
for(si in 1:length(states)-1) {
  if(base_soln_df$action[si] < .1 && base_soln_df$action[si+1] > .9) {
    tpt <- base_soln_df$state[si] + ((base_soln_df$state[2] - base_soln_df$state[1]) / 2)
  }
}

soln_plot(base_soln_df %>% filter(state <= state99th), tpt = tpt)

```


```{r res_bimodal, fig.cap = "Initial ecosystem states are distributed normally (mean = 0.5; S.D. = 0.2; truncated at [0,1]).  Agents follow decision strategy $\\pi$ as shown in Fig \\ref{fig:res_strategy} until $t = 20$.  (A) Ecosystem state of each agent over time (500 simulations).  (B) Initial ES distribution (dark blue) and final bimodal distribution at $t = 20$ (light blue).", fig.width = 6.5, fig.asp = .5, dpi=500}

ggarrange(
  soln_plot(base_soln_df %>% filter(state <= state99th), tpt = tpt),

  sim_plot_ts(sims_baseline, title = ggtitle("B. Timeseries"), rmarmod = -5), 
  sim_plot_dens(sims_baseline, title = ggtitle("C. State distributions"), 
                tpos = "panel", lab_lo_peak = TRUE, lab_hi_peak = TRUE, lmarmod = -5), 
  widths = c(3,2.75,2.2), nrow = 1, ncol = 3
)

# p_up_dn(sims_baseline)
```


## Importance of temporal dynamics in coupled system trajectories

Our baseline model shows how a simple coupling of human choices and ecological response can result in bistable landscapes of high and low diversification practice adoption and, as a result, high and low levels of ecosystem services (Fig 2). By vary the time horizon of the decision process, the rate of the ecological response, and the cost/benefit ratio, we find that this tipping point disappears when the speed of response of either the ecological system or decision-making process overwhelms the coupling (a proxy for decoupling). Figure 5A shows that with temporal human/environment interactions, there exists a region of cost/benefit ratio within which various bimodal ecosystem state distributions exist. However, when ecological processes become fast enough that the ecosystem responds almost immediately to farmer actions ($r=0.95$), alternate stable states do not emerge, regardless of cost-benefit ratios (Fig 5C). Similarly, as decisions become temporally myopic (in this case, with a time horizon of 2 decision cycles), the potential for bistability in adoption trajectories disappears (Fig 5B). Only when both a gradually changing environment and a forward-looking decision-maker (i.e. a farmer who takes into account potential benefits over the long term) are coupled, do tipping point phenomena emerge in the decision strategy, leading to two stable ecosystem service states (Fig 5).

```{r sim_b_sweep_fxn, include = FALSE}
sim_b_sweep <- function(scenarios, inf_fin, t_horiz = 2) {
  
  sim_b_sweep_scenario <- function(params) {
    model <- continuous_model(states, actions, params, transition_fn, utility_fn)
    if(inf_fin == "infinite") {
      soln <- MDPtoolbox::mdp_value_iteration(model$P, model$U, params$discount)
    } else if(inf_fin == "finite") {
      soln <- MDPtoolbox::mdp_finite_horizon(model$P, model$U, params$discount, N = t_horiz)
    } else stop('inf_fin must be "infinite" or "finite"')
    sim(soln, Tmax = params$Tmax) %>% 
      filter(time == params$Tmax)
  }
  
  scenarios %>%
    purrr::transpose() %>%
    furrr::future_map_dfr(sim_b_sweep_scenario, .id = "id") %>%
    left_join(scenarios, by = "id") %>%
    mutate(state = states[state])
}

```

```{r run_b_sweep_sims, cache = TRUE, include = FALSE}
# baselines: benefit = 1.57, cost = 1, sigma = 0.1, r = 0.1, discount = 0.97
chans_scenarios <- 
  tidyr::crossing(cbr = seq(.575, .725, length.out = 40),
                  cost = params$cost,
                  sigma = params$sigma,
                  r = params$r,
                  discount = params$discount,
                  Tmax = params$Tmax) %>% 
  tibble::rownames_to_column("id") %>%
  mutate(benefit = cost / cbr)
chans_sims <- sim_b_sweep(chans_scenarios, "infinite")

fast_r_scenarios <-
  tidyr::crossing(cbr = seq(.825, .975, length.out = 40),
                  cost = params$cost,
                  sigma = params$sigma,
                  r = 0.95,
                  discount = params$discount,
                  Tmax = params$Tmax) %>% 
  tibble::rownames_to_column("id") %>%
  mutate(benefit = cost / cbr)
fast_r_sims <- sim_b_sweep(fast_r_scenarios, "infinite")

myopic_d_scenarios <- 
  tidyr::crossing(cbr = seq(.025, .175, length.out = 40),
                  cost = params$cost,
                  sigma = params$sigma,
                  r = params$r,
                  discount = params$discount,
                  Tmax = params$Tmax) %>% 
  tibble::rownames_to_column("id") %>%
  mutate(benefit = cost / cbr)
myopic_d_sims <- sim_b_sweep(myopic_d_scenarios, "finite", t_horiz = 2)

```


```{r res_b_sweep, fig.cap = "For three scenarios (coupled human/natural system, overly-myopic decision maker, and overly-fast ecological change), cost/benefit ratio was varied incrementally over 40 values, indicated by color shade, across a $c:b$ range of width 0.15, encompassing the transition between a ``never invest'' to an ``always invest'' policy.  For each $c:b$, 500 replicate simulations were conducted as in Fig \\ref{fig:res_bimodal}.  Upper plots show distribution of ES state at $t=20$ for each $c:b$.  Lower plots show density curve peak(s).  (A) By coupling a forward-looking decision-maker and a slowly-adapting environment, complex dynamics like alternate stable states can emerge.  However, with (B) a short-term decision strategy (solving the MDP over a 2-year time horizon), or (C) a fast ecological change rate ($r = 0.95$), no bimodality is observed.", fig.width = 6.5, fig.asp = .55, dpi= 500}

ggarrange(
  ggarrange(
    plt_sim_b_sweep(chans_sims, title = ggtitle("A. Forward-looking decision \n     & slow ecological dynamics"), 
                    ylab = "Density", col = pal[1], rmarmod = -7, dnmarmod = -2.75) + 
      theme(legend.position="none"),
    plt_b_sweep_peaks(b_sweep_peaks(chans_sims), bizone = b_sweep_peaks(chans_sims, output_bizone = TRUE),
                      ylab = "Cost/benefit ratio", col = pal[1], rmarmod = -7, upmarmod = -2.75), 
    nrow = 2, ncol = 1, heights = c(1.1,1), align = "v"
  ),
  ggarrange(
    plt_sim_b_sweep(myopic_d_sims, title = ggtitle("B. Short-term decision \n strategy "), 
                    tpos = "panel", col = pal[4], lmarmod = -3.5, rmarmod = -3.5, dnmarmod = -2.75) + 
      theme(legend.position="none"),
    plt_b_sweep_peaks(b_sweep_peaks(myopic_d_sims), 
                      col = pal[4], lmarmod = -3.5, rmarmod = -3.5, upmarmod = -2.75), 
    nrow = 2, ncol = 1, heights = c(1.1,1), align = "v"
  ),
  ggarrange(
    plt_sim_b_sweep(fast_r_sims, title = ggtitle("C. Fast ecological \n dynamics"), 
                    tpos = "panel", col = pal[7], lmarmod = -7, dnmarmod = -2.75) + 
      theme(legend.position="none"),
    plt_b_sweep_peaks(b_sweep_peaks(fast_r_sims), 
                      col = pal[7], lmarmod = -7, upmarmod = -2.75), 
    nrow = 2, ncol = 1, heights = c(1.1,1), align = "v"
  ),
  nrow = 1, ncol = 3, widths = c(1,1,1)
)

```

## Implications for agricultural incentive design and land tenure policy
 
Implications for agricultural incentive design and land tenure policy
With approximately 39\% of U.S. farmland under lease (Service 2016), land tenure is increasingly impacting agricultural management. For example, U.S. corn farmers who rent land are less likely than landowners to implement grassed waterways, strip cropping, contour farming, and conservation tillage (Soule, Tegene, and Wiebe 2000). 

We solve the MDP on a constrained time horizon (20-decision cycles, in comparison to an infinite time horizon in Fig 2), representing the shorter horizon on which tenant farmers often make decisions (Fig 3B). Comparing the final state distribution of the long-tenure (baseline) versus the short-tenure model shows that, as a farmer’s expected land tenure duration decreases, it becomes optimal to reduce diversification adoption across a wider range of ecosystem states. This results in ecosystem state degradation even among farm sites with an initially high ecosystem service value, with 94\% of farmers ending up in the simplified state at $t=20$.

While land tenure impacts the temporal horizon of land-use decisions, incentives that influence management practices are also important factors in decision-making processes and have become an integral part of farming over the past half-century (Batáry et al. 2015; Graddy-Lovelace and Diamond 2017). We explore the impact of incentive duration on the efficacy of policies to promote adoption of diversification practices by implementing two competing publicly funded incentive schemes: a short-term (two-time step) incentive which fully covers the cost of adoption, versus a longer-term (ten-time step) incentive which only partially offsets the adoption costs over those time steps. Formally, the cost of each incentive package is equal. Within the model, agents adapt their optimal decision strategy for the given cost-benefit ratio during the incentive period, and at its conclusion they revert to the baseline strategy (i.e. without payments).

We find longer, more sustained incentive programs to be more effective at encouraging adoption behavior over the critical threshold toward diversified farming (Fig 4). Once a farmer has crossed the viable ecosystem state threshold, it becomes less likely that they will return to simplified systems, even after incentives are removed. Because it takes a series of investment actions for the ecosystem service state to cross the investment threshold, longer-term incentives ultimately result in more diversification practice adoption.


```{r short_tenure_sim, include = FALSE}
short_tenure_soln <- MDPtoolbox::mdp_finite_horizon(model$P, model$U, params$discount, N = 20) 
sims_short_tenure <- sim(short_tenure_soln)
```

```{r res_tenure, fig.cap = "The simulation is identical to that in Fig \\ref{fig:res_bimodal}, but the MDP is solved under a finite, 20-year time horizon. (A) Result of short land tenure on ES state over time.  (B) Comparison between final state distribution of short- vs. long-tenure model runs.", fig.width = 6.5, fig.asp = .5,dpi=500}
ggarrange(
  sim_plot_ts(sims_baseline, title = ggtitle("A. Long-tenure"),
            annotate = TRUE, 
              rmarmod = -10),
  sim_plot_ts(sims_short_tenure, 
              title = ggtitle("B. Short-tenure"), 
              endcol = pal[3], 
              tpos = "panel", ytxtoff = T,rmarmod = -5, lmarmod = -5),
  sim_plot_dens_comp(sims_baseline, sims_short_tenure, 
                     label1 = "Long\ntenure\nfinal", 
                     label2 = "Short\ntenure\nfinal", 
                     title = ggtitle("C. State distribution"), 
                     tpos = "panel", lmarmod = -5),
 nrow = 1, ncol = 3, widths = c(1,1,1))
```



```{r incentives_sim, include = FALSE}
# set incentive simulation parameters
T_incent_1 <- 2
T_incent_2 <- 10

# calc modified cost during incentive = 1 - 2 / T_incent
C_incent_1 <- 1 - 2 / T_incent_1
C_incent_2 <- 1 - 2 / T_incent_2

# incentive simulation fxn
incent_sim <- function(params) {
  incent_model <- continuous_model(states, actions, params, transition_fn, utility_fn)
  incent_soln <- MDPtoolbox::mdp_value_iteration(incent_model$P, incent_model$U, params$discount)
  # simulate incentive period
  start <- sim(incent_soln, Tmax = params$T_incent, x0 = init)
  xi <- start %>% filter(time == params$T_incent) %>% pull(state)
  # pad to Tmax with baseline decision rule
  rest <- sim(base_soln, Tmax = params$Tmax - params$T_incent, x0 = xi) %>% 
    filter(time!=0) %>% mutate(time = time + params$T_incent)
  bind_rows(start, rest) 
}

# run incentive simulation
sims_incent_abrupt <- incent_sim(list(benefit = params$benefit, 
                                      cost = C_incent_1, 
                                      sigma = params$sigma, 
                                      r = params$r, 
                                      discount = params$discount, 
                                      T_incent = T_incent_1, Tmax = params$Tmax))
sims_incent_sust <- incent_sim(list(benefit = params$benefit, 
                                    cost = C_incent_2, 
                                    sigma = params$sigma, 
                                    r = params$r, 
                                    discount = params$discount, 
                                    T_incent = T_incent_2, Tmax = params$Tmax))

```


```{r res_incentive, fig.cap = "Starting from the same initial states as Fig \\ref{fig:res_bimodal}, ES state timeseries are shown for (A) a large, abrupt incentive (100\\% of adoption expenses are covered for two years) vs. (B) a smaller, more sustained incentive (adoption cost is 80\\% of baseline for 10 years).  Ignoring discounting, both packages have the same total cost to the funder (the equivalent of 2 years' worth of full adoption cost offsets).  After the incentive period, agents adjust their decision rules to that of the base case (i.e. no incentive) until $t = 20$.  (C) Shows that the sustained incentive ultimately drove more DP adoption.", fig.width = 6.5, fig.asp= 0.5, dpi=500}

ggarrange(
  sim_plot_ts(sims_incent_abrupt, title = ggtitle("A. Concentrated incentive"), 
              annotate = TRUE, an_x = T_incent_1, an_lab = sprintf("%i cycles\n%i%% off", T_incent_1, round((1-C_incent_1)*100)), 
              rmarmod = -10, endcol = pal[5]),
  sim_plot_ts(sims_incent_sust, title = ggtitle("B. Sustained incentive"), 
              annotate = TRUE, an_x = T_incent_2, an_lab = sprintf("%i cycles\n%i%% off", T_incent_2, round((1-C_incent_2)*100)), 
              tpos = "panel", ytxtoff = T, endcol = pal[6], rmarmod = -5, lmarmod = -5),
  sim_plot_dens_comp(sims_incent_abrupt, sims_incent_sust, sims_base = sims_baseline, 
                     label1 = "Concentrated\nincentive", label2 = "Sustained\nincentive", label_base = "No\nincentive", 
                     title = ggtitle("C. Final distributions"), tpos = "panel", 
                     cvec = c(pal[2], pal[5], pal[6]), lmarmod = -5, rmarmod = -5),
  nrow = 1, ncol = 3, widths = c(1,1,1.2)
)

# print("abrupt: ")
# p_up_dn(sims_incent_abrupt)
# print("sustained: ")
# p_up_dn(sims_incent_sust)
```



# Discussion

```{r predictions, echo = FALSE, message=FALSE, fig.align='left', fig.cap='Some cool caption', out.width='1\\linewidth', fig.pos='H'}
knitr::include_graphics("external-figs/predictions.png")
```

Our analysis suggests a mechanism for bistability in social-ecological systems that is the result of temporal interactions between forward-looking decisions and ecological processes rather than complex structural assumptions about either system alone. While alternate stable states within coupled human and natural systems, and farming systems in particular, have been previously explored and observed (Horan et al. 2011; Vandermeer 1997; Vandermeer and Perfecto 2012), our results shed light specifically on temporal feedbacks that likely contribute to this pattern. We show how this mechanism provides novel insights not only for social-ecological research (Fig 5), but also for agricultural policy (Fig 3 and Fig 4).

Policies designed to promote agricultural sustainability in response to stressors such as climate change or soil degradation can have unintended consequences because when designed without explicit consideration of the feedback between human decision-making and ecosystem states. Our results suggest that long-term, sustained incentives, even when only partially covering the cost of adoption, may be more effective in shifting farmers from simplified ecological states to diversified states than more concentrated short-term incentives. We show that the cost of interventions and the social-environmental benefit of those interventions are not necessarily equivalent. Rather, perceived stability of incentive programs over time may be an important driver of adoption, which can be overlooked if the temporal rates of coupled dynamics in social-environmental systems are not considered. This is particularly relevant to government payment programs and suggests that payments can be highly effective in encouraging adoption of diversification practices when implemented over long time horizons. While the possibility of a policy discontinuation may contribute to the lack of impact for short-term incentives, reduced transaction costs that come with farmers making a longer-term commitment may also partially explain the greater impact of sustained incentives as compared to concentrated incentives. 

In addition to incentive policies, our analysis shows how secure land tenure can impact decision strategies and consequently is integral to increasing the adoption of diversified farming practices. This finding complements sociological research documenting how security and length of land tenure affects adoption of sustainable agricultural practices (Fraser 2004; Long et al. 2017; Richardson Jr 2015; Soule, Tegene, and Wiebe 2000). Policies that increase land tenure duration, such as regulating lease agreement terms, providing low interest loans, or promoting stable farm succession plans, may represent a key lever to enable farmers to adopt more diversified agroecological practices. 

By conceptualizing the adoption of diversified farming practices through this lens, we offer new insights into important agricultural policy conundrums such as precarious land tenure and unstable incentive programs. We present a flexible model framework that can be built on to address numerous questions in social-ecological systems and agricultural policy.  Expanding the boundaries of the model to include the effect of other structural factors, such as agricultural regulations, could expand the scope of questions explored.


## Mathematical description

The farmer's decision model can be expressed as

$$\max_{\lbrace a_t \rbrace} \mathbb{E} \left[ \sum_t^T u(s_t, a_t) \gamma^t \right]$$

where $\lbrace a_t \rbrace$ is the set of available actions, $\mathbb{E}$ the expected utility operator, $u(s_t, a_t)$ the utility which the farmer associates with being in state $s_t$ and taking action $a_t$ at time $t$, $\gamma$ the myopic discount factor, and $T$ the land tenure of the farm ($T \to \infty$ if the farmer owns the land or has a long lease).

We assume a simple model of the farmer's perceived utility $u(s_t, a_t)$ as a function of the difference between the cost $c_a$ associated with diversification practice action $a_t$, versus expected benefits $b_s$ derived from ecosystem state $s_t$, at time $t$, such that

$$u(s_t, a_t) = b_s s_t  - c_a a_t$$

The ecosystem state is also dynamic, evolving according to the transition probability function $p(s_t, a_t)$, such that

$$s_{t+1} = p(s_t, a_t) := s_t + r \left(a_t - s_t \right) + \epsilon$$

where $\epsilon \sim N(0, \sigma)$. This provides a minimal state transition model in which the parameter $r$ sets the natural timescale at which the ecosystem can respond to changes in land mangement decisions, and $\sigma$ defines the width of the state transition probability distribution, capturing the noise inherent to ecological system change.  While we have assumed very basic transition and utility functions for this stylized model, in general more complicated nonlinear functions for both the ecosystem state transition and perceived utility are possible using this framework.

## Model implementation
<!-- do we need this?? s.w.: I think it is useful - best to be clear about how we made it, and give credit to those who developed the tools-->
The model was developed in the *R* programming language [@RCT2019].  The *MDPtoolbox* library was used to set up and solve the MDP [@Chades2017], *tidyverse* for data analysis [@Wickham2019], and *ggplot2* to generate all figures [@Wickham2016].  Code for our model and the experiments conducted in this paper is available freely at [https://github.com/boettiger-lab/dfs-mdp](https://github.com/boettiger-lab/dfs-mdp).  

## Parameterization

We have parameterized the model to illustrate the emergence of bistability in CHANS resulting from agroecological investment decision-making given stochastic ecological responses over time.  Parameter values appear in Table \ref{tab:baseline_params}.

\begin{table}
\centering
\caption{Baseline parameter values}
\begin{tabular}{lc}
\hline
\textbf{Parameter} & \textbf{Value} \\
\hline
Benefit $b$	& 1.57 \\
Cost $c$	& 1.00 \\
Noise $\sigma$ & 0.1 \\
State response rate $r$ & 0.1 \\
Discount factor $\gamma$ & 0.97 \\
\hline
\end{tabular}
\label{tab:baseline_params}
\end{table}

# References
