---
title: "Tipping points in diversified farming systems" 
author:
  - name: Melissa Chapman
    affiliation: espm
  - name: Serge Wiltshire
    affiliation: espm
  - name: Timothy Bowles
    affiliation: espm
  - name: Liz Carlisle
    affiliation: ucsb
  - name: Fredrico Castillo
    affiliation: espm
  - name: David Gonthier
    affiliation: ky
  - name: Alastair Iles
    affiliation: espm
  - name: Daniel Karp
    affiliation: davis
  - name: Claire Kremen
    affiliation: espm, ucb
  - name: Jeff Liebert
    affiliation: cornell
  - name: Elissa Olimpi
    affiliation: davis
  - name: Matthew Ryan
    affiliation: cornell
  - name: Amber Sciligo
    affiliation: organic
  - name: Jennifer Thompson
    affiliation: espm
  - name: Hannah Waterhouse
    affiliation: espm
  - name: Kenzo Eszquivel
    affiliation: espm
  - name: Sasha Gennet
    affiliation: tnc
  - name: Carl Boettiger
    affiliation: espm
    footnote: Corresponding Author
address:
  - code: espm
    address: "Dept. of Environmental Science, Policy, and Management, University of California Berkeley, Berkeley, CA, USA"
  - code: ubc
    address: "Institute of Resources, Environment and Sustainability, University of British Columbia, Vancouver, BC, Canada"
  - code: ucsb
    address: "Environmental Studies, University of California Santa Barbara, Santa Barbara, CA, USA"
  - code: davis
    address: "Wildlife, Fish, and Conservation Biology, University of California Davis, Davis, CA, USA"
  - code: ky
    address: "Dept. of Entomology, University of Kentucky, Lexington, KY, USA"
  - code: cornell
    address: "School of Integrated Plant Science, Cornell University, Cornell, NY, USA"
  - code: organic
    address: "The Organic Center, Washington, DC, USA"
  - code: tnc
    address: "The Nature Conservancy, Arlington, VA, USA" # added location of TNC HQ to match other entries
    
abstract: The emergence and impact of tipping points are of great interest in both social and ecological research. Despite widespread recognition of the importance of feedbacks between human and environmental systems, it is often assumed that the observed nonlinear dynamics in these coupled systems rest within either underlying human or environmental processes. Using adoption of agroecological practices as a case study, we show how bistability in ecosystem states and services can emerge purely from the temporal feedbacks between human decisions and ecological responses. We propose that the mechanisms behind these dynamics have important implications for sustainability policy. Our results indicate how policies which increase the duration of land tenure and provide long-term incentives are particularly effective at enhancing the adoption of agricultural diversification practices.

keywords:
  - agriculture,
  - ecosystem services,
  - tipping points,
  - diversification practices,
  - decision-making
bibliography: references.bib
date: "`r Sys.Date()`"
output: rticles::elsevier_article
layout: 3p # review # review = doublespace, 3p = singlespace, 5p = two-column
header-includes: 
  - \journal{TBD}
  - \graphicspath{{ext-figs/}}
  - \usepackage{float}
  - \linenumbers
  - \usepackage{setspace}\doublespacing

---

```{r render_to_word_doc, include = FALSE, eval = FALSE}
# run this to generate a word doc
# not perfect, will have to format word doc after
library(rmarkdown)
render("dfs-mdp-manuscript.Rmd", word_document())

```


```{r setup, include = FALSE}
rm(list = ls(all.names = TRUE)) # clean environment

# load external scripts
source("../R/load-libraries.R")
source("../R/dfs-mdp-model.R")
source("../R/sim-plot-fxns.R")

knitr::opts_chunk$set(echo = FALSE,
                      cache = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      # eval = FALSE, # to knit faster - comment out to run code
                      fig.align = "center",
                      dev = "cairo_pdf")

pal <- solarized_pal()(7) # global color pallette
set.seed(4) # random seed
```

```{r model_def, include = FALSE}
# set up the MDP
actions <- seq(0, 1, length = 100)
states <- seq(0, 1.5, length = 100)
params <- list(
  benefit = 1.57, # changed from 1.56 to 1.57 to equalize distribution and help with fig 4 results
  cost = 1, 
  sigma = 0.1, 
  r = 0.1, 
  discount = 0.97, 
  Tmax = 20)
transition_fn <- function(s, a, params) s + params$r * (a - s)
utility_fn <- function(s, a, params) params$benefit * s - params$cost * a
model <- continuous_model(states, actions, params, transition_fn, utility_fn)

# solve the MDP
base_soln <- MDPtoolbox::mdp_value_iteration(model$P, model$U, params$discount)
base_soln_df <- tibble(state = states,
                       action = actions[base_soln$policy])

```

```{r global_sim_params, include = FALSE}
reps <- 500
init <- truncnorm::rtruncnorm(reps, 0, 1, 0.5, 0.2) %>% 
  map_int(function(x) which.min(abs(x - states)))
```


# Introduction

Both ecosystems and social systems have been observed to change states abruptly as the result of crossing a critical threshold. Theories of ecological multistability have long described this phenomenon [@scheffer2003catastrophic] and explored how ecological management impacts stability landscapes [@Horan7333], with tipping points assumed to stem from complex ecological processes like population dynamics [@mumby2007thresholds]. Similarly, examples of tipping points in social systems, ranging from the collapse of civilizations [@downey2016european] to social network processes such as the spread of innovations [@kuehn2014critical] suggest that these nonlinearities may result from complex features of human systems. Despite widespread interest in the mechanisms of tipping points in integrated socio-ecological systems, it has generally been assumed that the underlying nonlinear dynamics can be ascribed to either social processes *or* natural phenomena.

Empirically exploring tightly coupled social-environmental systems presents numerous research challenges [@kline2017integrating].  In such systems, human actions impact ecological processes, and the resultant changes create feedbacks that alter the scope and efficacy of future actions [@ostrom2009general; @walker2004resilience; @liu2007complexity].  For example, agricultural management choices can enhance or degrade ecological services that affect the long-term productive capacity of the land, impacting future financial returns, and limiting future decision possibilites [@zhang2007ecosystem].  Additionally, the temporal dynamics of ecological processes do not always align with the temporal scale of human decision-making.  For example, land management to promote ecosystem services may require sequential investments over time and/or take years to accrue [@morandin2016pest; @blaauw2014flower], meaning adoption of these practices requires decisionmakers to be forward looking, adaptive, and cognizant of environmental and economic dynamics and uncertainty. 

Agriculture is a fundamental driver of anthropogenic ecological change [@stoate2009ecological; @foley2005global; @foley2011solutions], providing a valuable context to examine how social and ecological systems interact. It is increasingly recognized that effective policies to promote agricultural sustainability require interdisciplinary approaches which consider both human decision-making and ecology as a coupled human-and-natural system [@liu2007complexity; @alberti2011research].  Here we use the adoption of diversified farming practices as a case study to explore such emergent properties [@kremen2012diversified].  In the context of diversified farming systems, diversification practices are defined as those that bolster ecosystem services by promoting beneficial agrobiodiversity, such as composting, intercropping, insectary strips, crop rotation, and cover cropping [@kremen2012diversified].  This definition of diversification is distinct from the concept of operational diversification (i.e. simply increasing the range of agricultural goods produced on a given farm).  Although existing research has explored how diversification practices affect ecological and financial outcomes [@rosa2019ecological], a deeper understanding  of the feedbacks between adoption of a given practice, resultant ecological change, and future decision landscapes is integral to informing policy design.  Such a framework opens space to analyze how diversified farming systems affect and are affected by ecosystem processes. 

Computational approaches to explore structural attributes of human-environment systems can suggest levers of change [@nicholson2019scenarios] and highlight important assumptions to explore empirically. While adoption of sustainable farm management, and more specifically diversification practices, undoubtable encompass a continuum of actions and outcomes, it is largely understood that these practices often coalesce around distinct stable states [@andow1989experimental; @vandermeer1997syndromes] and that fundamental shifts can occur from small changes in conditions when tipping points are reached  [@vandermeer2012syndromes].  While existing understanding of these dynamics rests on the assumption that the system , existing techniques to investigate dynamic ecological processes and responsive decision-making do not generally allow for forward-looking decision-makers [@lippe2019using] and may misrepresent the complex coupling of these systems.

This paper presents a stylized model of the adoption of diversification practices to explore the ecosystem patterns that result specifically from interactions between adaptive decision-making and an ever-changing environment.  We find a novel mechanism for bistability that is the result not of complex structural assumptions within either the human or natural system, but simply the rates at which the two systems interact over time.  While our model necessarily simplifies both decision-making and environmental processes, it provides a framework explore emergent properties in coupled human and natural systems.  Additionally, we suggest that our findings have important implications for agricultural policy design.

# Conceptual model description

We explore the transition to and from diversified farming systems using a Markov Decision Process in which a fruit/vegetable farmer makes a series of agroecological choices over time.  The model was developed through an iterative, participatory process in collaboration with an interdisciplinary team encompassing plant and soil scientists, agricultural economists, ecologists, agricultural policy experts, social scientists, and farmers.  The goal was to develop a stylized model that can be understood by a wide audience, while still capturing the core complexities stemming from the inherent coupled human and natural dynamics of the modeled system (Fig \ref{fig:res_conceptual}).  

Each season the farmer takes an "action" of 0\% to 100\% investment in adopting or maintaining diversification practices.  The "system state" coresponds to the level of benefit derived from the ecosystem services that result from those adoption decisions, and can include financial, social, ideological, and aesthetic considerations.  Higher actions correspond to a greater probability of transitioning to a higher (more beneficial) ecological state the next year.  While higher ecological states are beneficial, higher actions also come with a greater associated cost.  By defining parameter values for cost, benefit, transition stochastiticity, ecological change rate, and future discounting (values given in Methods, Tab \ref{tab:baseline_params}), we can calculate the optimal action strategy to be used by the agent based on expected rewards over either a definite or infinite time horizon.  

```{r assumption, echo = FALSE, message=FALSE, fig.align='center', fig.cap='Some cool caption', out.width='1.1\\linewidth', fig.pos='H'}
knitr::include_graphics("external-figs/assumptions.png")
```



# Results

Using the described model, we observe the behavior of agents' sequential choices and resultant environmental outcomes over time.  Agents' initial ecosystem states were distributed normally around a mean of $\bar{s} = 0.5$.  Fig \ref{fig:res_bimodal} shows that, after following the optimal decision strategy for 20 years, agents have largely settled into two groups, with some farms transitioning to more simplfied (conventional) farming systems, and others to more diversified (agroecological) systems.  Further, we find strong path dependency, with only 17\% of agents who started in a simplified ($s < 0.5$) state concluding in a diversified ($s > 0.5$) state, and only 7\% initially in the diversified state transitioning to simplified.

```{r base_case_sim, include = FALSE}
sim <- function(soln, 
                Tmax = params$Tmax,
                x0 = init){
  map_dfr(1:length(x0), 
          function(i) sim_mdp(model$P, model$U, soln$policy, params$discount, x0 = x0[i], Tmax = Tmax), 
          .id = "reps")
}
sims_baseline <- sim(base_soln)
# p_up_dn(sims_baseline)
```


```{r res_strategy, fig.cap = "Optimal decision strategy $\\pi$ as a function of ES state, showing a tipping point at $s \\approx 0.52$.  The upper $x$ axis limit is the 99th percentile of observed states in our simulation results ($s \\approx 1.3$).", fig.width = 3, fig.asp = 1, include=FALSE}

state99th <- sims_baseline %>% 
  mutate(state = states[state]) %>% 
  pull(state) %>% 
  quantile(.99) %>% 
  unname()
tpt <- 0
for(si in 1:length(states)-1) {
  if(base_soln_df$action[si] < .1 && base_soln_df$action[si+1] > .9) {
    tpt <- base_soln_df$state[si] + ((base_soln_df$state[2] - base_soln_df$state[1]) / 2)
  }
}

soln_plot(base_soln_df %>% filter(state <= state99th), tpt = tpt)

```


```{r res_bimodal, fig.cap = "Initial ecosystem states are distributed normally (mean = 0.5; S.D. = 0.2; truncated at [0,1]).  Agents follow decision strategy $\\pi$ as shown in Fig \\ref{fig:res_strategy} until $t = 20$.  (A) Ecosystem state of each agent over time (500 simulations).  (B) Initial ES distribution (dark blue) and final bimodal distribution at $t = 20$ (light blue).", fig.width = 6.5, fig.asp = .5, dpi=500}

ggarrange(
  soln_plot(base_soln_df %>% filter(state <= state99th), tpt = tpt),

  sim_plot_ts(sims_baseline, title = ggtitle("B. Timeseries"), rmarmod = -5), 
  sim_plot_dens(sims_baseline, title = ggtitle("C. State distributions"), 
                tpos = "panel", lab_lo_peak = TRUE, lab_hi_peak = TRUE, lmarmod = -5), 
  widths = c(3,2.75,2.2), nrow = 1, ncol = 3
)

# p_up_dn(sims_baseline)
```

## Optimal decision strategy

The decision strategy $\pi$ describes the optimal course of action for a given state and is used by all agents across replicate simulations.  For the parameterization given in Tab \ref{tab:baseline_params}, and with an infinite time horizon, the resultant $\pi$ is shown in Fig \ref{fig:res_strategy}.  This reveals a tipping point at a specific ecosystem state, below which the highest expected value is derived by investing little to nothing into diversified farming systems, and above which the optimum action becomes near-full investment. Over time, this results in the bimodal distribution of ecosystem states seen in Fig \ref{fig:res_bimodal}. 

## Land tenure

With 39\% of U.S. farmland under lease [@usda2016], the impact of land tenure on agricultural management has been increasingly scrutinized.  For example, a study of U.S. corn farmers found that renters were less likely than land owners to implement grassed waterways, strip cropping, contour farming, and conservation tillage [@soule2000land]. Similarly, a study conducted in British Columbia found that tenant farmers planted fewer perennial crops than land owners [@fraser2004land].  In addition, investments in agroecology may require access to credit, which often also hinges on secure land tenure as collateral [@richardson2015land].

<!-- Changed from 2-year to 20-year time horizon, so that we still have some complexity here.  We use two-year for the "unrealistically-short" time horizon in fig 6, so I thought it would be good to distinguish this experiment from the other. -->

Using the same parameters as above, we solve the MDP on a finite 20-year time horizon, representing the shorter window within which tenant farmers often make decisions (Fig \ref{fig:res_tenure}).  Comparing the final state distribution of the baseline versus the short-tenure model shows that, as a farmer's expected land tenure duration decreases, it becomes optimal to reduce agroecological adoption across a wider range of ecosystem states.  This results in ecosystem state degradation even among farm sites with an initially high ES value, with 94\% of farmers ending up in the simplified state at $t=20$.  

```{r short_tenure_sim, include = FALSE}
short_tenure_soln <- MDPtoolbox::mdp_finite_horizon(model$P, model$U, params$discount, N = 20) 
sims_short_tenure <- sim(short_tenure_soln)
```

```{r res_tenure, fig.cap = "The simulation is identical to that in Fig \\ref{fig:res_bimodal}, but the MDP is solved under a finite, 20-year time horizon. (A) Result of short land tenure on ES state over time.  (B) Comparison between final state distribution of short- vs. long-tenure model runs.", fig.width = 6.5, fig.asp = .5,dpi=500}
ggarrange(
  sim_plot_ts(sims_baseline, title = ggtitle("A. Long-tenure"),
            annotate = TRUE, 
              rmarmod = -10),
  sim_plot_ts(sims_short_tenure, 
              title = ggtitle("B. Short-tenure"), 
              endcol = pal[3], 
              tpos = "panel", ytxtoff = T,rmarmod = -5, lmarmod = -5),
  sim_plot_dens_comp(sims_baseline, sims_short_tenure, 
                     label1 = "Long\ntenure\nfinal", 
                     label2 = "Short\ntenure\nfinal", 
                     title = ggtitle("C. State distribution"), 
                     tpos = "panel", lmarmod = -5),
 nrow = 1, ncol = 3, widths = c(1,1,1))
```

## Agroecological incentives

While land tenure is intertwined with land use decisions, agricultural incentives have become an integral part of farming over the past half-century [@graddy2017supply]. Agricultural incentives such as cost-sharing and reimbursement programs have a range of goals, one of which is to promote sustainable management practices. We explore the impact of incentive duration on the efficacy of policies to promote diversification practice adoption by implementing two competing incentive structures: a short-term (two-year) incentive which covers the cost of diversification practice adoption, versus a longer-term (ten-year) incentive which only partially offsets the adoption costs over those years. Formally, the cost of each incentive package to the taxpayer is equal. Within the model, agents adapt their decision strategy during the incentive period, and at its conclusion they revert to the baseline strategy.  

Fig \ref{fig:res_incentive} shows that longer, more sustained incentive programs may be more effective at nudging behavior over the critical threshold toward diversification practice adoption. Because of the tipping point in the decision strategy, once an agent has crossed the viable ecosystem state threshold, it becomes much less likely that they will fall back toward the simplified state.  Since ecosystem state change in the model is stochastic, as it is in real-world ecosystems, it may take a series of investment actions before the ecosystem reacts.  Due to this time delay, longer-term incentives have a higher chance of nudging behavior beyond the critical threshold, ultimately resulting in more agroecological practice adoption.  


```{r incentives_sim, include = FALSE}
# set incentive simulation parameters
T_incent_1 <- 2
T_incent_2 <- 10

# calc modified cost during incentive = 1 - 2 / T_incent
C_incent_1 <- 1 - 2 / T_incent_1
C_incent_2 <- 1 - 2 / T_incent_2

# incentive simulation fxn
incent_sim <- function(params) {
  incent_model <- continuous_model(states, actions, params, transition_fn, utility_fn)
  incent_soln <- MDPtoolbox::mdp_value_iteration(incent_model$P, incent_model$U, params$discount)
  # simulate incentive period
  start <- sim(incent_soln, Tmax = params$T_incent, x0 = init)
  xi <- start %>% filter(time == params$T_incent) %>% pull(state)
  # pad to Tmax with baseline decision rule
  rest <- sim(base_soln, Tmax = params$Tmax - params$T_incent, x0 = xi) %>% 
    filter(time!=0) %>% mutate(time = time + params$T_incent)
  bind_rows(start, rest) 
}

# run incentive simulation
sims_incent_abrupt <- incent_sim(list(benefit = params$benefit, 
                                      cost = C_incent_1, 
                                      sigma = params$sigma, 
                                      r = params$r, 
                                      discount = params$discount, 
                                      T_incent = T_incent_1, Tmax = params$Tmax))
sims_incent_sust <- incent_sim(list(benefit = params$benefit, 
                                    cost = C_incent_2, 
                                    sigma = params$sigma, 
                                    r = params$r, 
                                    discount = params$discount, 
                                    T_incent = T_incent_2, Tmax = params$Tmax))

```


```{r res_incentive, fig.cap = "Starting from the same initial states as Fig \\ref{fig:res_bimodal}, ES state timeseries are shown for (A) a large, abrupt incentive (100\\% of adoption expenses are covered for two years) vs. (B) a smaller, more sustained incentive (adoption cost is 80\\% of baseline for 10 years).  Ignoring discounting, both packages have the same total cost to the funder (the equivalent of 2 years' worth of full adoption cost offsets).  After the incentive period, agents adjust their decision rules to that of the base case (i.e. no incentive) until $t = 20$.  (C) Shows that the sustained incentive ultimately drove more DP adoption.", fig.width = 6.5, fig.asp= 0.5, dpi=500}

ggarrange(
  sim_plot_ts(sims_incent_abrupt, title = ggtitle("A. Concentrated incentive"), 
              annotate = TRUE, an_x = T_incent_1, an_lab = sprintf("%i cycles\n%i%% off", T_incent_1, round((1-C_incent_1)*100)), 
              rmarmod = -10, endcol = pal[5]),
  sim_plot_ts(sims_incent_sust, title = ggtitle("B. Sustained incentive"), 
              annotate = TRUE, an_x = T_incent_2, an_lab = sprintf("%i cycles\n%i%% off", T_incent_2, round((1-C_incent_2)*100)), 
              tpos = "panel", ytxtoff = T, endcol = pal[6], rmarmod = -5, lmarmod = -5),
  sim_plot_dens_comp(sims_incent_abrupt, sims_incent_sust, sims_base = sims_baseline, 
                     label1 = "Concentrated\nincentive", label2 = "Sustained\nincentive", label_base = "No\nincentive", 
                     title = ggtitle("C. Final distributions"), tpos = "panel", 
                     cvec = c(pal[2], pal[5], pal[6]), lmarmod = -5, rmarmod = -5),
  nrow = 1, ncol = 3, widths = c(1,1,1.2)
)

# print("abrupt: ")
# p_up_dn(sims_incent_abrupt)
# print("sustained: ")
# p_up_dn(sims_incent_sust)
```


## Importance of temporal dynamics in coupled system trajectories

Our model shows how a simple coupling of human choices and ecological response can result in bistable landscapes of high and low diversification practice adoption.  Importantly, this tipping point disappears when human and natural systems are decoupled.  To explore this, we incrementally sweep through cost/benefit ratios and examine the effect on final ecosystem state distributions.  As the cost-benefit ratio increases, the decision strategy favors full investment into diversification practices, and conversely, a sufficiently low ratio will result in no diversification practice adoption.  

Fig \ref{fig:res_b_sweep} shows that, with human/environment interaction, there exists a region of cost/benefit space within which various bimodal ecosystem state distributions emerge.  However, when ecological processes become fast enough that the ecosystem responds almost-immediately to farmer actions ($r = 0.95$), it becomes impossible to parameterize the model's cost-benefit ratio to result in alternate stable states.  Similarly, as decisions become temporally-myopic (time horizon = 2 yrs.), the potential for bistability also disappears.  Only when both a gradually-changing environment and a forward-looking decision-maker are coupled do tipping point phenomena emerge in the decision strategy, leading to alternate stable diversification states.  

```{r sim_b_sweep_fxn, include = FALSE}
sim_b_sweep <- function(scenarios, inf_fin, t_horiz = 2) {
  
  sim_b_sweep_scenario <- function(params) {
    model <- continuous_model(states, actions, params, transition_fn, utility_fn)
    if(inf_fin == "infinite") {
      soln <- MDPtoolbox::mdp_value_iteration(model$P, model$U, params$discount)
    } else if(inf_fin == "finite") {
      soln <- MDPtoolbox::mdp_finite_horizon(model$P, model$U, params$discount, N = t_horiz)
    } else stop('inf_fin must be "infinite" or "finite"')
    sim(soln, Tmax = params$Tmax) %>% 
      filter(time == params$Tmax)
  }
  
  scenarios %>%
    purrr::transpose() %>%
    furrr::future_map_dfr(sim_b_sweep_scenario, .id = "id") %>%
    left_join(scenarios, by = "id") %>%
    mutate(state = states[state])
}

```

```{r run_b_sweep_sims, cache = TRUE, include = FALSE}
# baselines: benefit = 1.57, cost = 1, sigma = 0.1, r = 0.1, discount = 0.97
chans_scenarios <- 
  tidyr::crossing(cbr = seq(.575, .725, length.out = 40),
                  cost = params$cost,
                  sigma = params$sigma,
                  r = params$r,
                  discount = params$discount,
                  Tmax = params$Tmax) %>% 
  tibble::rownames_to_column("id") %>%
  mutate(benefit = cost / cbr)
chans_sims <- sim_b_sweep(chans_scenarios, "infinite")

fast_r_scenarios <-
  tidyr::crossing(cbr = seq(.825, .975, length.out = 40),
                  cost = params$cost,
                  sigma = params$sigma,
                  r = 0.95,
                  discount = params$discount,
                  Tmax = params$Tmax) %>% 
  tibble::rownames_to_column("id") %>%
  mutate(benefit = cost / cbr)
fast_r_sims <- sim_b_sweep(fast_r_scenarios, "infinite")

myopic_d_scenarios <- 
  tidyr::crossing(cbr = seq(.025, .175, length.out = 40),
                  cost = params$cost,
                  sigma = params$sigma,
                  r = params$r,
                  discount = params$discount,
                  Tmax = params$Tmax) %>% 
  tibble::rownames_to_column("id") %>%
  mutate(benefit = cost / cbr)
myopic_d_sims <- sim_b_sweep(myopic_d_scenarios, "finite", t_horiz = 2)

```


```{r res_b_sweep, fig.cap = "For three scenarios (coupled human/natural system, overly-myopic decision maker, and overly-fast ecological change), cost/benefit ratio was varied incrementally over 40 values, indicated by color shade, across a $c:b$ range of width 0.15, encompassing the transition between a ``never invest'' to an ``always invest'' policy.  For each $c:b$, 500 replicate simulations were conducted as in Fig \\ref{fig:res_bimodal}.  Upper plots show distribution of ES state at $t=20$ for each $c:b$.  Lower plots show density curve peak(s).  (A) By coupling a forward-looking decision-maker and a slowly-adapting environment, complex dynamics like alternate stable states can emerge.  However, with (B) a short-term decision strategy (solving the MDP over a 2-year time horizon), or (C) a fast ecological change rate ($r = 0.95$), no bimodality is observed.", fig.width = 6.5, fig.asp = .55, dpi= 500}

ggarrange(
  ggarrange(
    plt_sim_b_sweep(chans_sims, title = ggtitle("A. Forward-looking decision \n     & slow ecological dynamics"), 
                    ylab = "Density", col = pal[1], rmarmod = -7, dnmarmod = -2.75) + 
      theme(legend.position="none"),
    plt_b_sweep_peaks(b_sweep_peaks(chans_sims), bizone = b_sweep_peaks(chans_sims, output_bizone = TRUE),
                      ylab = "Cost/benefit ratio", col = pal[1], rmarmod = -7, upmarmod = -2.75), 
    nrow = 2, ncol = 1, heights = c(1.1,1), align = "v"
  ),
  ggarrange(
    plt_sim_b_sweep(myopic_d_sims, title = ggtitle("B. Short-term decision \n strategy "), 
                    tpos = "panel", col = pal[4], lmarmod = -3.5, rmarmod = -3.5, dnmarmod = -2.75) + 
      theme(legend.position="none"),
    plt_b_sweep_peaks(b_sweep_peaks(myopic_d_sims), 
                      col = pal[4], lmarmod = -3.5, rmarmod = -3.5, upmarmod = -2.75), 
    nrow = 2, ncol = 1, heights = c(1.1,1), align = "v"
  ),
  ggarrange(
    plt_sim_b_sweep(fast_r_sims, title = ggtitle("C. Fast ecological \n dynamics"), 
                    tpos = "panel", col = pal[7], lmarmod = -7, dnmarmod = -2.75) + 
      theme(legend.position="none"),
    plt_b_sweep_peaks(b_sweep_peaks(fast_r_sims), 
                      col = pal[7], lmarmod = -7, upmarmod = -2.75), 
    nrow = 2, ncol = 1, heights = c(1.1,1), align = "v"
  ),
  nrow = 1, ncol = 3, widths = c(1,1,1)
)

```

# Discussion

```{r predictions, echo = FALSE, message=FALSE, fig.align='left', fig.cap='Some cool caption', out.width='1\\linewidth', fig.pos='H'}
knitr::include_graphics("external-figs/predictions.png")
```

Our analysis suggests a mechanism for bistability in coupled human and natural systems that is not the result of complex structural assumptions about either system alone, but rather the temporal interactions between forward-looking decisions and ecological processes. While the concepts of regime shifts and tipping points within coupled human and natural systems [@lade2013regime] have been previously explored, our results cast light on temporal mechanisms that might help to explain this phenomenon. We suggest this knowledge provides novel considerations not only for coupled human and natural systems research but also agricultural policy. 

While we present one mechanism for bistability in diversified practice adoption, other mechanisms have been presented to explain bistability in agroecological practice adoption. For example, research on production syndromes shows that structure of agricultural systems is based on numerous drivers and components of social-ecological systems (e.g., market opportunities, regulations, etc.) which can create alternative stable states characterized as production syndromes [@vandermeer2012syndromes]. Although such external economic and market drivers were not integrated into this analysis, by representing diversified agroecological adoption as a coupled system, we find that the observed bistability may be the result of tipping points in the optimal sequence of management that effect slow ecological processes, rather than tipping points inherent in the ecological dynamics or the cognitive/social predispositions of human agents alone.  


In light of historical agricultural catastrophes like the Dust Bowl, the importance of informed policy action in response to stressors like climate change and soil degradation is imperative. Policy designed to promote agricultural sustainability can have complex ramifications [@ipes2018breaking].  In our model, we find that compared to short-term incentives, longer-term packages were found to be more successful in moving farmers who started in the simplified ecological states to  diversified states. Similarly, while land tenure is largely known to affect sustainable agricultural practice adoption [@soule2000land; @fraser2004land; @richardson2015land; @long2017hedgerow], we illustrate why secure land tenure is integral to the adoption of diversified agroecological practices. Policies that increase land tenure duration, such as regulating lease agreement terms, providing low interest loans, or promoting stable farm succession plans, may represent a key lever to nudge farmers toward more diversified agroecological systems. Likewise, perceived stability of incentive programs over time may be an important driver of efficacy, which can be overlooked when not considering the temporal components of coupled social-environmental systems.  With U.S. Farm Bills being overhauled every five years, a farmer may have limited confidence that a critical incentive program will be sufficiently long-lived, suggesting that a policy lever may be to extend the sunsetting of agroecological policy bills [@jackson200950].  

With no inherent complexity in the ecological model, and decision-making agents that simply optimize their expected utility based on current conditions, our model generates the bimodal distribution of agroecological practice adoption and ecological outcomes.  By conceptualizing the adoption of diversified farming practices through this lens, we offer new insights into important agricultural policy conundrums.  Several limitations of this model should be considered. We do not draw distinctions between diversification practices that have different cost structures or ecological outcomes. Additionally, our model does not capture market dynamics resulting from feedbacks between production and consumption, but rather conceives of the system as a commodity market within which an individual farmer's production does not influence the market price.  We also do not consider ecosystem services or deleterious environmental effects that spillover from neighboring farms. However, these can all be integrated into the presented framework and offer potential avenues for future research.  

# Methods

We developed a Markov Decision Process model to represent a farmer's agroecological adoption choices over time.  The model's state space is a vector with a lower bound of 0 and a soft upper bound of 1, with the system state $s_t$ representing the degree to which the agent derives ecosystem service benefits $b_s$ from the diversification practices they have implemented on their farm.  Actions to increase investments in diversification practices probabilistically increase or decrease the future system state, with $r$ defining the rate at which the ecosystem responds to change.  While agents may stochastically transition to $s>1$, investments into diversification practices do not positively correlate with the probability of upward state transitions beyond $s=1$.

The action space is a continuous vector from 0 to 1, with $a=0$ representing no investment of resources into DP adoption or maintenance, and $a=1$ representing the highest conceivable level of investment.  Investment in diversification practices incurs costs $c_a$, either as a direct result of implementation (e.g. equipment, materials, and labor), opportunity costs (e.g. forgone yields due to reduced cultivated acreage or lost production efficiency), or both.

The time step $t$ corresponds to a single growing season.  At each time step, the agent chooses an action based on their current state by following decision strategy $\pi$.  This strategy is calculated by maximizing expected utility for each state/action pair over the full time horizon using a Stochastic Dynamic Programming (SDP) approach [@marescot2013complex], with the discount rate $\gamma$ determining how much the agent values current rewards relative to future rewards.


## Mathematical description

The farmer's decision model can be expressed as

$$\max_{\lbrace a_t \rbrace} \mathbb{E} \left[ \sum_t^T u(s_t, a_t) \gamma^t \right]$$

where $\lbrace a_t \rbrace$ is the set of available actions, $\mathbb{E}$ the expected utility operator, $u(s_t, a_t)$ the utility which the farmer associates with being in state $s_t$ and taking action $a_t$ at time $t$, $\gamma$ the myopic discount factor, and $T$ the land tenure of the farm ($T \to \infty$ if the farmer owns the land or has a long lease).

We assume a simple model of the farmer's perceived utility $u(s_t, a_t)$ as a function of the difference between the cost $c_a$ associated with diversification practice action $a_t$, versus expected benefits $b_s$ derived from ecosystem state $s_t$, at time $t$, such that

$$u(s_t, a_t) = b_s s_t  - c_a a_t$$

The ecosystem state is also dynamic, evolving according to the transition probability function $p(s_t, a_t)$, such that

$$s_{t+1} = p(s_t, a_t) := s_t + r \left(a_t - s_t \right) + \epsilon$$

where $\epsilon \sim N(0, \sigma)$. This provides a minimal state transition model in which the parameter $r$ sets the natural timescale at which the ecosystem can respond to changes in land mangement decisions, and $\sigma$ defines the width of the state transition probability distribution, capturing the noise inherent to ecological system change.  While we have assumed very basic transition and utility functions for this stylized model, in general more complicated nonlinear functions for both the ecosystem state transition and perceived utility are possible using this framework.

## Model implementation
<!-- do we need this?? s.w.: I think it is useful - best to be clear about how we made it, and give credit to those who developed the tools-->
The model was developed in the *R* programming language [@RCT2019].  The *MDPtoolbox* library was used to set up and solve the MDP [@Chades2017], *tidyverse* for data analysis [@Wickham2019], and *ggplot2* to generate all figures [@Wickham2016].  Code for our model and the experiments conducted in this paper is available freely at [https://github.com/boettiger-lab/dfs-mdp](https://github.com/boettiger-lab/dfs-mdp).  

## Parameterization

We have parameterized the model to illustrate the emergence of bistability in CHANS resulting from agroecological investment decision-making given stochastic ecological responses over time.  Parameter values appear in Table \ref{tab:baseline_params}.

\begin{table}
\centering
\caption{Baseline parameter values}
\begin{tabular}{lc}
\hline
\textbf{Parameter} & \textbf{Value} \\
\hline
Benefit $b$	& 1.57 \\
Cost $c$	& 1.00 \\
Noise $\sigma$ & 0.1 \\
State response rate $r$ & 0.1 \\
Discount factor $\gamma$ & 0.97 \\
\hline
\end{tabular}
\label{tab:baseline_params}
\end{table}

# References
