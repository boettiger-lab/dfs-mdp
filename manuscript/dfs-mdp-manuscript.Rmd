---
# title: "Alternate Stable States in Farming System Diversification: Effects of Land Tenure, Environmental Shocks, and Subsidy Structures" #original title
# title: "Tipping points in the adoption of sustainable agricultural practices: A coupled human and natural systems approach." #Carl's
#title: "Getting over the hump: A coupled human and natural systems approach to the adoption of sustainable agricultural practices." #Serge's
title: "Tipping points in sustainable agriculture adoption" 
author:
  - name: Melissa Chapman
    affiliation: espm
  - name: Serge Wiltshire
    affiliation: espm
  - name: Timothy Bowles
    affiliation: espm
  - name: Claire Kremen
    affiliation: espm
  - name: Kathryn De Master
    affiliation: espm
  - name: "...others in group"
    affiliation: espm
  - name: Carl Boettiger
    affiliation: espm
    footnote: Corresponding Author
address:
  - code: espm
    address: "Dept of Environmental Science, Policy, and Management, University of California Berkeley, Berkeley CA 94720-3114, USA"
  - code: ubc
    address: "University of British Columbia"
abstract: |
keywords:
  - diversified practices,
  - ecosystem services
bibliography: alt_stable_states.bib
date: "`r Sys.Date()`"
output: rticles::elsevier_article
layout: 3p # review # review = doublespace, 3p = singlespace, 5p = two-column
header-includes: 
  - \journal{TBD}
  - \graphicspath{{ext-figs/}}
  - \usepackage{float}

---

```{r setup, include = FALSE}
rm(list = ls(all.names = TRUE)) # clean environment

# load external scripts
source("../R/load-libraries.R")
source("../R/continuous-model.R")
source("../R/sim-plot-fxns.R")
source("../R/caorwa-plot-fxns.R")
# load CA_OR_WA farmer survey dataset
caorwa_data <- read.csv("../external-data/ADAPT_CA-OR-WA_2_2020.csv")

knitr::opts_chunk$set(echo = FALSE,
                      cache = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      fig.align = "center",
                      dev = "cairo_pdf")

pal <- solarized_pal()(7) # global color pallette
set.seed(4) # random seed
```

```{r model_def, include = FALSE}
# set up the MDP
actions <- seq(0, 1, length = 100)
# Allow max(state) > max(actions) to avoid creating a hard boundary on ecosystem state
states <- seq(0, 1.5, length = 100)
params <- list(benefit = 1.57, cost = 1, sigma = 0.1, r = 0.1)
discount <- 0.97
transition_fn <- function(s, a, params) s + params$r * (a - s)
utility_fn <- function(s, a, params) params$benefit * s - params$cost * a
model <- continuous_model(states, actions, params, transition_fn, utility_fn)

# solve the MDP
base_soln <- MDPtoolbox::mdp_value_iteration(model$P, model$U, discount)
base_soln_df <- tibble(state = states,
                       action = actions[base_soln$policy])

# soln_plot(base_soln_df)
#write_csv(base_soln_df, "../model-data/base_soln_df.csv.gz")
```

```{r global_sim_params, include = FALSE}
reps <- 500
init <- truncnorm::rtruncnorm(reps, 0, 1, 0.5, 0.2) %>% 
  map_int(function(x) which.min(abs(x - states)))

```

<!-- MANUSCRIPT START -->

\section{Introduction}

Agriculture is among the most fundamental drivers of anthropogenic ecological change \cite{stoate2009ecological}, providing a valuable context for examining core properties of the human-environment nexus.  While agriculture influences both human and ecosystem well-being, practices vary in their environmental impacts, long term sustainability, financial viability, and climate resilience.  It is increasingly recognized that effective policies to address environmental issues, including the long term sustainability of agricultural practices, requires interdisciplinary approaches which consider both human decision-making and ecology as a coupled human and natural system (CHANS) {cite, cite} .  

However, empirically exploring such tightly-enmeshed dynamic systems presents numerous challenges.  Human decisions, such as adopting sustainable agricultural practrices, impact ecological processes and the resultant changes create feedbacks that alter the scope and efficacy of future decisions \cite{ostrom2009general, walker2004resilience, liu2007complexity}.  Decisions can enhance or degrade ecological services that affect the long-term productive capacity of the land base and impact future financial returns \cite{zhang2007ecosystem}.  However, the temporal dynamics of ecological processes do not always align with the temporal scale of human decision-making.  Many ecosystem services that emerge from sustainable farming practices take years to accrue, meaning adoption of these practices requires decisionmakers to be foreward looking, adaptive, and comfortable with environmental and economic uncertainty.  For example, practices to reduce topsoil loss and harmful runoff such as riparian buffers and hedgerows require up to seven years to provide sufficient ecosystem benefits to offset the costs required for implementation and maintenance \cite{rein1999economic}. 

Here we focus on Diversified Farming Systems (DFS), which are characterized by practices which promote beneficial biodiversity and bolster ecosystem services, enhancing farm- and landscape-scale productivity \cite{kremen2012diversified}.  While existing DFS research has increased our understanding of how diversification practices affect ecological and financial outcomes, an integrated approach requires a consideration of the feedback loop between adoption of a given practice, resultant ecological outcomes, and future adoption decision factors.  For example, community composition of birds and soil microbes jointly influence food safety through the incidence and suppression of foodborne pathogens, and are impacted by farm level decisions about practices. An integrated CHANS approach to questions about sustainability provides an framework to increase scientific understanding of the potential synergies and tradeoffs of how diversified farming practices affect and are affected by ecosystem processes.

While understanding structural attributes and qualitative dynamics of human-environment systems can provide valuable information on effective levers of change and important assumptions to explore empirically, much of the existing literature in this area focuses either on human decision-making (with ecological processes being exogenous to the model), or explores the complexity of ecological processes without sufficiently considering adaptive human agents \cite{vandermeer2012syndromes}.  Further, those techniques that do present dynamic processes and responsive decision-making don't generally allow for forward looking decision agents \cite{lippe2019using}, ultimately misrepresenting the complex coupling of systems that proceed at fundementally different rates.  This paper presents a stylized coupled human and natural systems model of DFS adoption to explore the complex dynamical properties that result specifically from interactions between an adaptive agent and a changing environment.  While we do not suggest that our model captures the full complexity of individual decision making or environmental processes, it does provide a novel framework for integrating empirical findings and exploring emergent dynamics of coupled human and natural systems.


\section{Conceptual model description}

We explore the transition to and from diversified farming systems using a Markov Decision Process (MDP), in which an agent makes a series of choices about their interactions with the environment (\ref{fig:res_conceptual}).  In this case, the agent represents a single farm unit.  We formulate a 'system state' to represent the degree of beneficial ecological services derived from the farm's investments into diversification practices.  Each farming season the agent chooses an action, described by a spectrum from 0\% to 100\% investment in adopting or maintaining diversification practices.  More investment corresponds to a greater probability of transitioning to a higher (more beneficial) ecological state the next year.  While transitioning to a higher ecological state provides the agent an increased benefit, higher investment actions also come with a greater associated cost.  Using these parameters, we can calculate the optimal action for each state, known as the 'policy', based on the agent's future cumulative discounted rewards over a defined time horizon.  

\begin{figure}
\centering 
\includegraphics[width=.75\textwidth]{external-figs/dfs_mdp_conceptual_fig_4.pdf}
\caption{High level conceptual DFS-MDP illustration, showing the system state in green (with a higher state corresponding to increased diversification practices), the DP investment decision in blue, and the interaction between the farmer's perceived utility function $u()$ and the state transition probability function $p()$.}\label{fig:res_conceptual}
\end{figure}


\section{Results}

Using the model described above, we conduct a series of simulation runs to observe the behavior of agents' sequential choices and resultant environmental outcomes over time.  Parameter values used in the simulations appear in Table \ref{tab:baseline_params}.  Agents' initial ecosystem states are distributed normally with a mean at $\bar{S} = 0.5$.  Fig \ref{fig:res_bimodal} shows that, after having followed policy $\pi$ for nine timesteps, at $t = 10$ agents have largely bifurcated into two groups, with some farms transitioning to more "simplified" farming systems, and others to more "diversified" systems.  Further, we find strong path dependency, with only 11\% of runs which started in a simplified ($S < 0.5$) state concluding in a diversified ($S > 0.5$) state, and only 7\% of runs initially in the diversified state transitioning to simplified.

\begin{table}
	\centering
	\caption{Base case parameter values}
	\begin{tabular}{lc}
		\hline
		\textbf{Parameter}			& \textbf{Value} \\
		\hline
		Benefit ($b$)	& 1.57 \\
		Cost ($c$)	& 1.00 \\
		Transition stochasticity ($\sigma$) & 0.1 \\
		Ecosystem response rate ($r$) & 0.1 \\
		Discount factor ($\gamma$) & 0.97 \\
		\hline
	\end{tabular}
	\label{tab:baseline_params}
\end{table}


```{r base_case_sim, include = FALSE}
sim <- function(soln, 
                Tmax = 10,
                x0 =  init){
  map_dfr(1:length(x0), 
          function(i) mdp_planning(model$P, model$U, discount, policy = soln$policy, x0 = x0[i], Tmax = Tmax), 
          .id = "reps")
}
sims_baseline <- sim(base_soln)
#write_csv(sims_baseline, "../model-data/sims_baseline.csv.gz")
```


```{r res_bimodal, fig.cap = "Simulations of 500 model agents over ten farming seasons.  Initial ES states follow a truncated normal distribution (mean = 0.5; S.D. = 0.2; truncated at [0,1]).  Agents utilize decision policy $\\pi$ as shown in Fig \\ref{fig:res_policy} for nine timesteps.  (A) shows the state of each agent throughout each run.  (B) shows the initial ES distribution (dark blue) and bimodal density distribution at $t = 10$ (light blue), with peaks annotated. (C) shows the observed bimodal DP adoption distribution in our survey data.", fig.width = 6, fig.asp = .5}

ggarrange(
  sim_plot_ts(sims_baseline, title = ggtitle("A. ES state over time"), rmarmod = -5), 
  sim_plot_dens(sims_baseline, title = ggtitle("B. State distribution"), lab_lo_peak = TRUE, lab_hi_peak = TRUE, lmarmod = -5), 
  caorwa_dp_count_hst(caorwa_data, title = ggtitle("C. Empirical distrib.")), 
  widths = c(3, 2, 1.75), nrow = 1, ncol = 3
)

# p_up_dn(sims_baseline)
```

\subsubsection{Optimal decision policy}
The decision policy, $\pi$, describes the optimal course of action for a given state, with each agent in the simulation above using this policy to guide their decision-making.  Fig \ref{fig:res_policy} reveals that there is a critical bifurcation, or tipping point, at an specific ecosystem state, below which the highest expected value is derived by investing little to nothing into diversified farming systems.  Above the threshold, the optimum action becomes near-full investment into diversified farming systems. Over time, this results in a bimodal distribution of ecosystem states, as seen in Fig \ref{fig:res_bimodal}. 

```{r res_policy, fig.cap = "Optimal decision policy $\\pi$ as a function of ecosystem state.  The upper $x$ axis limit is the 99th percentile of observed states in our simulation results ($\\approx 1.23$).", fig.width = 3, fig.asp = 1}

state99th <- sims_baseline %>% 
            mutate(state = states[state]) %>% 
            pull(state) %>% 
            quantile(.99) %>% 
            unname()

soln_plot(base_soln_df %>% filter(state <= state99th))

```


\subsection{Land tenure}

With 39\% of U.S. farmland under lease (USDA NASS 2016 find citation), and with widely-varying rental agreements, the impact of land tenure on best-managment-practice adoption has been increasingly examined in agricultural lands.  For example, a study of U.S. corn producers found that cash renters were less likely than land owners to implement grassed waterways, strip cropping, contour farming, or conservation tillage \cite{soule2000land}.  A study conducted in British Columbia found that tenant farmers planted fewer perennial crops than land owners \cite{fraser2004land}.  Our own ongoing research with lettuce farmers in California's Salinas Valley suggests that land tenure is an important factor in decisions about cover cropping and crop rotation.  In addition, investments in diversified farming practices may require access to credit, which often also hinges on secure land tenure as a form of collateral \cite{richardson2015land}.

Using the same simulation methods and parameters outlined above, we solve the decision model on a finite, two-year time horizon, representing the shorter window within which many tenant farmers may make decisions (Fig \ref{fig:res_tenure}).  Comparing the final state distribution of the baseline model to the short tenure model shows that, as length of land tenure or stability of lease agreements decline, optimal decisions are calculated more myopically and farmers are incentivized to severely limit investment into diversified practives.  This results in a degredation of ecosystem state even among those plots with an initially high value, with 92\% of farmers ending up in the simplified state.  Our model data echoes empirical findings from a recent large-scale survey of U.S. west coast produce growers, which shows that farmers who primarily own their land are roughly 20\% more likely to invest in at least one diversification practice.  

```{r short_tenure_sim, include = FALSE}
short_tenure_soln <- MDPtoolbox::mdp_finite_horizon(model$P, model$U, discount, N = 2)
sims_short_tenure <- sim(short_tenure_soln)
#write_csv(sims_short_tenure, "../model-data/sims_short_tenure.csv.gz")
```

```{r res_tenure, fig.cap = "(A) Result of short land tenure on DEP adoption.  The simulation is identical to that in Fig \\ref{fig:res_bimodal}, but the MDP is solved under a finite, two-year time horizon. (B) Comparison between final state distribution of short- vs. long-tenure model runs.  (C) Probability of ecosystem services state being $\\geq 0.15$ at $t=10$ for the short-tenure simulation vs. the base-case simulation. (D) Impact of land tenure on the probability of a farmer in our survey dataset adopting at least one DP.", fig.width = 6, fig.asp = .5}

ggarrange(
  sim_plot_ts(sims_short_tenure, title = ggtitle("A. Short-tenure timeseries"), endcol = pal[3], rmarmod = -5),
  sim_plot_dens_comp(sims_baseline, sims_short_tenure, label1 = "Long\ntenure\nfinal", label2 = "Short\ntenure\nfinal", title = ggtitle("B. ES state distribution"), lmarmod = -5, rmarmod = -5),
  ggarrange(
    sim_tenure_thresh_bar(sims_baseline, sims_short_tenure, title = ggtitle("C. Simulation data")), 
    caorwa_tenure_thresh_bar(caorwa_data, title = ggtitle("D. Empirical data")), 
    nrow = 2, ncol = 1),
  widths = c(2.5, 2.5, 1.65), nrow = 1, ncol = 3
)

# p_up_dn(sims_short_tenure)
```


\subsection{Subsidy structures}

While land tenure is intertwined with land use decisions, agricultural subsidies have also become an integral part of farming over the past half-century, and policymakers are continually called upon to weigh farm viability against food affordability and environmental sustainability {>>cite farm bill, etc.<<}.  In recent years, climate change, soil degradation, and water use/quality considerations have increasingly pressured agricultural policy optimization {>>cite<<}.  Some have suggested that large, short-term subsidies may be more efficacious in nudging farmers toward management systems that effectively weigh these tradeoffs, while others are proponents of long-term, yet smaller subsidies {>>cite<<}. The capacity to explore the impacts of policy in the framework of a sequentially decisions that impact ecological systems allows us to investigate this question in silico.  

Using the same initial setup as described above, we implement two competing subsidy structures: a short-term (two-year) subsidy which completely covers the cost of transitioning to a more diversified state, versus a longer-term (ten-year) subsidy which only marginally offests the transition cost.  Formally, the cost of each subsidy package to the issuing organization is equal, and in fact the short-term subsidy is technically more valuable if economic discounting is applied.  Within the model, agents adapt their decision policy $\pi$ during the subsidy period, and at its conclusion they revert to base case (i.e. subsidy-free) decision rules.  
Fig \ref{fig:res_subsidy} shows that longer, more sustained subsidies may be more beneficial to nudge behavior over the critical threshold toward more sustainable systems in the long term.  Comparing these experimental results to those in Fig \ref{fig:res_bimodal}, we find that both subsidy packages were effective in shifting farmers to a sustained higher ecosystem-services state.  However, the sustained subsidy was much more effective at moving the needle.  Due to the previously-discussed "tipping point" dynamic inherent in the model, once an agent has crossed the threshold to the diversified state, it becomes much less likely that they will fall back toward the "simplified" state, at least in the short term.  With state-transition stochasticity a major factor in a given model run (as it is in the real world), longer-term subsidy packages have a higher chance of nudging behavior beyond the critical threshold.  

<!-- However, as the ecological dynamics increase in rate, which is relevant in analagous contexts of sequentially controlled ecological systems, this effect decreases (create figure for this?). -->


```{r subsidies_sim, include = FALSE}
subs_sim <- function(params) {
  subs_model <- continuous_model(states, actions, params, transition_fn, utility_fn)
  subs_soln <- MDPtoolbox::mdp_value_iteration(subs_model$P, subs_model$U, discount)
  # simulate subsidy period
  start <- sim(subs_soln, Tmax = params$Tsubs, x0 = init)
  xi <- start %>% filter(time == params$Tsubs) %>% pull(state)
  # pad to Tmax with baseline decision rule
  rest <- sim(base_soln, Tmax = params$Tmax - params$Tsubs + 1, x0 = xi) %>% filter(time!=1) %>% mutate(time = time + params$Tsubs - 1)
  bind_rows(start, rest) 
}

sims_subs_abrupt <- subs_sim(list(benefit = 1.57, cost = 0, sigma = 0.1, r = .1, Tsubs = 2, Tmax = 20))
sims_subs_sust <- subs_sim(list(benefit = 1.57, cost = .8, sigma = 0.1, r = .1, Tsubs = 10, Tmax = 20))
# sims_subs_v_sust <- subs_sim(list(benefit = 1.57, cost = .9, sigma = 0.1, r = .1, Tsubs = 20, Tmax = 20)) # did a real long one, just to see

#write_csv(sims_subs_abrupt, "../model-data/sims_subs_abrupt.csv.gz")
#write_csv(sims_subs_sust, "../model-data/sims_subs_sust.csv.gz")
```

```{r res_subsidy, fig.cap = "Replicate simulations from 500 normally-distributed starting states (mean = 0.5; S.D. = 0.2; truncated at [0,1]) over 20 timesteps.  (A) shows the effects of a large, abrupt subsidy (100\\% of adoption expenses are covered during the initial two years).  (B) simulates a smaller, yet more sustained subsidy (adoption cost is 80\\% of baseline during the first 10 years).  Ingoring discounting, subsidies have the same total cost to the funder (the equivalent of 2 years' worth of full adoption cost offsets).  After subsidy is removed, agents adjust their decision rule to that of the base case (i.e. no subsidy) for the remainder of the run.  (C) shows that the sustained subsidy drove more adoption at $t = 20$.", fig.width = 6, fig.asp = .5}
ggarrange(
  sim_plot_ts(sims_subs_abrupt, title = ggtitle("A. Abrupt subsidy"), rmarmod = -10, endcol = pal[5]),
  sim_plot_ts(sims_subs_sust, title = ggtitle("B. Sustained subsidy"), ytxtoff = T, endcol = pal[6], rmarmod = -5, lmarmod = -5),
  sim_plot_dens_comp(sims_subs_abrupt, sims_subs_sust, sims_base = sims_baseline, label1 = "Abrupt\nsubsidy", label2 = "Sustained\nsubsidy", label_base = "No\nsubsidy", title = ggtitle("C. Final ES state distribution"), cvec = c(pal[2], pal[5], pal[6]), lmarmod = -5, rmarmod = -5),
  nrow = 1, ncol = 3, widths = c(1,1,1)
)

# print("abrupt: ")
# p_up_dn(sims_subs_abrupt)
# print("sustained: ")
# p_up_dn(sims_subs_sust)
```


<!-- ```{r subsidies, include = FALSE} -->
<!--  start of code for r changing analysis -->
<!-- subsidies <-  -->
<!--   tidyr::crossing(# Do all combinations of: -->
<!--                   #cost = seq(0, 1, by = 0.1), -->
<!--                   Tsubs = seq(2, 10, by = 1), -->
<!--                   r = seq(0.1, 3, by = .2), -->
<!--                   benefit = 1.57,  -->
<!--                   sigma = 0.1, -->
<!--                   Tmax = 20 -->
<!--   ) %>% tibble::rownames_to_column("id") %>% -->
<!--   mutate(cost = (Tsubs-2)/10) -->
<!-- ``` -->

<!-- We then create a function to simulate the multiple scenarios through -->
<!-- time -->

<!-- ```{r simulate, include = FALSE} -->
<!-- subs_sim <- function(row) { -->
<!--   subs_model <- continuous_model(states, actions, row, transition_fn, utility_fn) -->
<!--   subs_soln <- MDPtoolbox::mdp_value_iteration(subs_model$P, subs_model$U, discount) -->
<!--   # simulate subsidy period -->
<!--   start <- sim(subs_soln, Tmax = row$Tsubs, x0 = init) -->
<!--   xi <- start %>% filter(time == row$Tsubs) %>% pull(state) -->
<!--   # pad to Tmax with baseline decision rule -->
<!--   params <- list(benefit = 1.57, cost = 1, sigma = 0.1, r = row$r) -->
<!--   model <- continuous_model(states, actions, params, transition_fn, utility_fn) -->
<!--   # solve the MDP -->
<!--   no_subs_soln <- MDPtoolbox::mdp_value_iteration(model$P, model$U, discount) -->
<!--   rest <- sim(no_subs_soln, Tmax = row$Tmax - row$Tsubs + 1, x0 = xi) %>% filter(time!=1) %>% mutate(time = time + row$Tsubs - 1) -->
<!--   bind_rows(start, rest) %>% filter(time == 20) %>% summarise(mean(state)) -->
<!-- } -->

<!-- no_subs_sim <- function(row) { -->
<!--   model <- continuous_model(states, actions, row, transition_fn, utility_fn) -->
<!--   soln <- MDPtoolbox::mdp_value_iteration(model$P, model$U, discount) -->
<!--   # simulate subsidy period -->
<!--   # pad to Tmax with baseline decision rule -->
<!--   sim(soln, Tmax = 20) %>% filter(time == 20) %>% summarise(mean(state)) -->
<!-- } -->
<!-- ``` -->


<!-- ```{r no_subsidy_r, include = FALSE} -->
<!-- no_subsidy <-  -->
<!--   tidyr::crossing(# Do all combinations of: -->
<!--                   # Tsubs = 11, -->
<!--                   r = seq(0.1, 3, by = .2), -->
<!--                   benefit = 1.57,  -->
<!--                   sigma = 0.1, -->
<!--                   Tmax = 20, -->
<!--                   cost = 1 -->
<!--   ) %>% tibble::rownames_to_column("id")  -->
<!-- ``` -->
<!-- And apply that function to all of the scenarios of interest -->

<!-- ```{r all_subsidies, include = FALSE} -->
<!-- no_sub_results <- no_subsidy %>% -->
<!--   purrr::transpose() %>%  -->
<!--   furrr::future_map_dfr(no_subs_sim, .id = "id") %>%  -->
<!--   left_join(no_subsidy, by = "id") %>% -->
<!--   rename(no_sub_state = `mean(state)`) %>% -->
<!--   select(r, no_sub_state) -->

<!-- sub_results <- subsidies %>% -->
<!--   purrr::transpose() %>%  -->
<!--   furrr::future_map_dfr(subs_sim, .id = "id") %>%  -->
<!--   left_join(subsidies, by = "id") %>% -->
<!--   left_join(no_sub_results, by = "r") -->
<!-- ``` -->

<!-- ```{r grid, fig.cap = "how does r effect subsidy structure impacts", fig.width = 4.5, fig.asp = 1} -->
<!-- sub_results %>% rename(state = `mean(state)`) %>% -->
<!--   mutate(delta = state-no_sub_state)%>% ggplot(aes(x = Tsubs, y = r, fill = state)) + geom_tile()   -->

<!-- ``` -->


\section{Discussion}

Recent research in complexity theory reveals the importance of understanding nonlinear behaviors within dynamical systems.  For example, when pushed beyond some threshold, a system may enter a virtually-irreversible state, driving its behavior into divergent basins of attraction, even given potent countervailing actions on the part of a decision-maker \cite{bar2019dynamics}.  These types of complex dynamics have been observed empirically across a wide variety of SESs, such that the identification of effective policy measures to effect change in these areas have been described as "wicked problems" that often confound traditional methods of analysis \cite{head2008wicked}.

While much of the research on agriculture has continued to revolve around unidisciplinary approaches, \cite{francis2008transdisciplinary}, computational methods like agent-based modeling, network analytics, and machine learning have been employed and provided important insights \cite{lippe2019using, wiltshire2018using, wiltshire2019network}. However, these tools often rely on predefined decision rules, removing the dynamic and responsive nature of agent decision making and planning and with that the capacity to explore different levers of change, such as subsidies, insurance, and land tenure, to those decisions in varying ecological environments.  

Representing the coupled human-environmental system as a controlled dynamic system we find that the empirically-observed bistability in the adoption of diversification practices adoption may be the result of tipping points in optimal sequential control, rather than inherent tipping points in the ecological dynamics themselves. The model we present here represents a simplified and stylized version of the feedbacks between  human decision making and ecological processes of diversification practice adoption.  While the concept of alternate stable states and tipping points within agricultural SESs has been previously explored \cite{vandermeer2012syndromes}, our experimental results cast light on several core mechanisms that help to explain these behaviors, suggesting novel considerations as policymakers work to enhance the sustanability and resilience of agricultural production systems.  

In light of historical agricultural catastrophes like the dust bowl, both scholars and society have called for swift action around  stressors like climate change, soil degradation, water quality, and biodiversity loss.  Policymakers have responded by developing programs which offer incentives and support for agriecological practice adoption, yet designing effective policies has proven challenging.  Recent case studis emphasize that policy mechanisms designed to promote agricultural sustainability have complex ramifications across various contexts \cite{ipes2018breaking}.  Critical to designing incentives is an understanding of the thresholds which render a given management practice viable to one farmer while nonviable to another.   

While it is well known that many practices that increase ecosystem services can take several years before significant beneficial effects are realized \cite{carlisle2014diversity, long2017hedgerow}. We find a threshold such that agents on each side of a tipping point are drawn to alternate stable states, one being more simplfied and the other more diversified.  This leads to path dependency, whereby a farmer who begins with degraded land is incentivized to transition even more toward the simplified state while a farmer who begins with well-cared-for, fertile land is incentivized to adopt management practices that maintain and improve functional diversification.  Given this finding, we suggest that a key lever of change for policymakers interested in promoting adoption of agrienvironmental practices may be to increasingly focus on supporting farmers' transitions within the critical window from the simplified to the diversified state by opening space for viable intermediate states.  Given this, binary certifications like the organic standard may be critiqued in some for some of their unintended consequences.  Although organic systems often use diversification practices, rules governing organic agriculture stipulate allowable inputs rather than strategic management of biodiversity; and producers are either certified or not, even if the ways in which farmers implement organic agriculture is quite heterogeneous \cite{shennan2017organic}.  An increasing focus on adoption of individual practices, rather than a cut and dried standard, may allow for a process of incremental transition, with farmers embedded in monocultural agricultural systems able to move stepwise toward the adoption of diversification practice.

While certification and therefore cost structures are important for adoption tajectories, the impact of secure land tenure is integral to adoption diversification practices.  Growers who either own land or have a long lease agreement are incentivized to invest more in the long-term productive capacity of their land, which can result in adoption of agrienvironmental practices that have an upfront cost, yet pay out over longer time horizons.  If farmers maximize their expected value on only a two-year time horizon, there is a strong incentive to maximize short-term profits by disinvesting in diversification practices.  

Subsidies are a fundamental part of modern U.S. agricultural policy, be it through direct payments, or, under more recent farm bills, heavy subsidization of crop insurance premiums.  Our subsidy experiment shows that---all else being equal---a given quantity of taxpayer funding devoted to diversification practices will more-effectively move the needle if it is guaranteed over a longer period rather than being offered as a lump sum.  Specifically, we find that a sustained subsidy was successful in moving 43\% of farmers who started in the simplified state to the diversified state, whereas the figure was only 24\% for the abrupt subsidy.  A ramification of this finding is that the perceived stability of suibsidy programs may be important in promoting agrienvironmental practice adoption.  Since, as we have seen, the transitional "hump" between the two stable states represents a precarious economic position, if a subsidy is not guaranteed for a long enough period to get over the hump toward DFS, the rational farmer will be incentivized to simply continue in their simplified state.  With U.S. farm bills being completely overhauled every five years or so, a farmer may have limited confidence that a critical subsidy program will be sufficiently long-lived, suggesting that a policy lever may be to prolong the sunsetting of any new agrienvironmental subsidy.  

Several limitations of this study must be acknowledged.  We do not draw distinctions between diversification practices that require large up-front costs versus those that require continual maintenance, instead lumping practices together into a generalized framework.  Our model does not capture market dynamics resulting from feedbacks between production and consumption, but rather conceives of the system as a commodity market within which an individual grower's production does not influence the overarching market price.  We also do not consider ecosystem services and/or deleterious environmental effects that spill over from neighboring farmers' practices.  Each of these areas remains a potential avenue for future research.  

** CONCLUSION PARAGRAPH** 
Despite these simplifications, our analysis provides a novel approach to 


\section{Methods}

DFS-MDP is a Markov Decision Process model (etc... briefly describe history and impetus of MDPs and include citations)

The state space $S$ is a vector with a lower bound of 0, and a soft upper bound of 1, with the system state $s_t$ representing the degree to which the agent derives ecosystem services benefits $b_s$ such as soil productivity, water infiltration, and climate resilience from the diversification practices they have implemented on their farm.  Actions to increase investments in diversification practices probabalistically increase or decrease the future system state, with $r$ defining the rate at which the ecosystem responds to change.  While agents may stochastically transition to $s>1$, investments into diversification practices do not positively correlate with the probability of upward state transitions beyond $s=1$.  In our simulation runs, the 99th percentile of states actually encountered by agents was $\approx 1.23$.  

The action space $A$ is a continuous vector from 0 to 1, with $a=0$ representing no investment of resources into DP adoption and maintenance and $a=1$ representing the highest conceivable level of investment.  Investment in diversification practices incurs costs $c_a$, either as a direct result of implementation (e.g. equipment, materials, and labor), opportunity costs (e.g. forgone yields due to reduced cultivated acreage or lost production efficiency), or both.  

The time step $t$ corresponds to a single growing season.  At each time step, the agent chooses an action based on their current state by following decision policy $\pi$.  $\pi$ is calculated by maximizing expected utility for each state/action pair over the full time horizon using a Stochastic Dynamic Programming (SDP) approach \cite{marescot2013complex}, with the discount rate $\gamma$ determining how much the agent values current rewards relative to future rewards.


\subsection{Model mathematical description}

The farmer's decision model can be expressed as

$$\max_{\lbrace a_t \rbrace} \mathbb{E} \left[ \sum_t^T u(s_t, a_t) \gamma^t \right] $$

where $\lbrace a_t \rbrace$ is the set of available actions to be taken at each point in time $t$, $\gamma$ is the discount rate, $\mathbb{E}$ the expectation operator, and $u(x_t, a_t)$ the utility which the farmer associates with being in state $s_t$ and taking action $a_t$ at time $t$. $T$ is the land tenure of the farm ($T = \infty$ if the farmer owns the land or otherwise expects to be able to farm the same land and thus benefit from the ecosystem services established there indefinitely).

We assume a simple model for the farmer's utility $u(s_t, a_t)$ as a combination of the costs $c$ associated with the diversification practice investment action $a$ and the benefits $b$ derived from the ecosystem state $s$ (which is in turn influenced by the practices adopted)

$$u(s_t, a_t) = b s_t  - c a_t$$

The ecosystem state is also dynamic, evolving according to the transition probability function $p(s_t, a_t)$:

$$s_{t+1} = p(s_t, a_t) := s_t + r \left(a_t - s_t \right)$$ 

This provides a minimal, one-parameter state transition model in which the parameter $r$ sets the natural timescale at which the ecosystem can respond to a change in mangement practice.  

{>>Need to include sigma in the equation<<} To capture stochastic noise inherent to the ecological system, $\sigma$ defines the spread of the state transition probability distribution.  

While we have assumed very basic transition and utility functions for this stylized model, in general more complicated nonlinear functions of both the ecosystem state transition and derived utility are possible in this framework.  


\subsection{Model implementation}

Our MDP was developed in R, using the MDPtoolbox library.  {>>ETC...<<}


\subsection{Parameterization from field observations and empirical data}

To establish the general parameters of our MDP model, our interdisciplinary research team began by exploring empirical evidence about the real-world drivers and distributions of farmers' adoption of diversification-enhancing practices.  We take a twofold approach, beginning with qualitative observations of trends within a relatively-small sample, and then testing hypotheses using results from a large-scale survey.  

\subsubsection{Original interviews}

Members of our team conducted interviews and on-farm observational studies of 20 organic lettuce growers and 8 technical assistance providers based in the California central coast region.  The sample was stratified to include growers across the spectrum of scale and market outlet.  Based on these studies, several important trends emerge.  Echoing previous research in this area, we find that adoption of DEPs tends to be bimodal; that is, growers are likely to either intensively-adopt many DEPs, or to adopt these practices minimally or not-at-all.  This may be explained by factors including limited capital availability to implement those DEPs with high up-front costs, food safety stipulations based on market outlet, risk attitude, and myopic discounting.  Land tenure---in terms of both length of time on the land, and whether land is leased versus owned---also appears to be a salient decision factor.  

\subsubsection{Survey dataset}

To evaluate the extent to which these observed adoption distributions hold quantitatively, we leverage a dataset of survey responses from 295 vegetable growers in Washington, Oregon, and California (!!CITE DATA SOURCE!!).  Table \ref{tab:dps_in_survey} shows the set of DPs queried in the survey, with their adoption rates across the entire sample.  A histogram plotting the number of diversification practices used by each grower (Fig \ref{fig:res_bimodal}B) shows a bimodal distribution, with growers generally tending to either adopt zero DPs---the most likely case---or else to adopt many, with six practices being the next-most-likely.

\begin{table}
	\centering
	\caption{Diversification practices in the survey data}
	\begin{tabular}{lc}
		\hline
		\textbf{DP Name}			& \textbf{Adoption rate} \\
		\hline
		Crop Rotation (3 or more)	& 63\% \\
		Cover Cropping				& 68\% \\
		Intercropping				& 52\% \\
		Insectary Plantings			& 61\% \\
		Riparian Buffers			& 84\% \\
		Border Plantings			& 45\% \\
		Compost or Manure			& 75\% \\
		Reduced Tillage				& 69\% \\
		\hline
	\end{tabular}
	\label{tab:dps_in_survey}
\end{table}


As discussed above, land tenure has often been shown to be a decision factor that impinges upon agricultural management practice adoption \cite{soule2000land, fraser2004land, richardson2015land, long2017hedgerow}.  Growers who have a long-term personal stake in the productive quality of their soil ecology are more likely to take the long view and invest in practices that will benefit them years down the line.  On the other hand, growers who are uncertain whether they will personally be farming a given parcel of land in future seasons may be less likely to adopt practices whose positive effects will not come to fruition in the short term.  To investigate the effect of land tenure on DEP adoption, we partition the dataset into growers who primarily own their land versus those who primarily lease it.  Figure \ref{fig:res_tenure}B shows that owners in our sample are about 20\% more likely than leasers to invest in at least one diversification practice.  



\bibliography{alt_stable_states}

